# Advanced configuration with all features
# This example demonstrates comprehensive configuration options

<match application.**>
  @type sumologic_radiant

  endpoint https://collectors.sumologic.com/receiver/v1/http/YOUR_UNIQUE_CODE_HERE

  # Source metadata with dynamic values
  source_category ${tag_parts[0]}/${tag_parts[1]}
  source_name ${tag}
  source_host ${hostname}

  # Log format configuration
  log_format json
  log_key message
  add_timestamp true
  timestamp_key @timestamp

  # Custom fields for enhanced searchability
  # These are added as X-Sumo-Fields header
  custom_fields environment=production,application=myapp,team=platform

  # Compression for bandwidth efficiency
  compress true
  compress_encoding gzip

  # SSL/TLS configuration
  verify_ssl true
  ca_file /etc/ssl/certs/ca-bundle.crt

  # Network timeouts
  open_timeout 60
  send_timeout 120
  receive_timeout 60

  # Proxy configuration (if needed)
  # proxy_uri http://proxy.example.com:8080

  # Advanced: Use sumo_metadata_key for per-record metadata
  # This allows overriding source_category, source_name, etc. per record
  sumo_metadata_key _sumo_metadata

  # Buffer configuration for high-volume production use
  <buffer tag>
    @type file
    path /var/log/fluentd-buffers/sumologic-app

    # Flush settings
    flush_mode interval
    flush_interval 10s
    flush_at_shutdown true
    flush_thread_count 4

    # Retry settings
    retry_type exponential_backoff
    retry_wait 5s
    retry_max_interval 5m
    retry_timeout 72h
    retry_forever false

    # Chunk settings
    chunk_limit_size 5M
    total_limit_size 10G
    overflow_action drop_oldest_chunk

    # Performance tuning
    compress gzip
  </buffer>

  # Slow flush log for monitoring
  <secondary>
    @type file
    path /var/log/fluentd/sumologic-failed
    compress gzip
  </secondary>
</match>
